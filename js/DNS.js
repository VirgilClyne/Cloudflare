class t{constructor(){this.name="Lodash",this.version="1.2.0",console.log(`\n${this.name} v${this.version}\n`)}get(e={},t="",s=void 0){Array.isArray(t)||(t=this.toPath(t));const o=t.reduce(((e,t)=>Object(e)[t]),e);return void 0===o?s:o}set(e={},t="",s){return Array.isArray(t)||(t=this.toPath(t)),t.slice(0,-1).reduce(((e,s,o)=>Object(e[s])===e[s]?e[s]:e[s]=/^\d+$/.test(t[o+1])?[]:{}),e)[t[t.length-1]]=s,e}unset(e={},t=""){return Array.isArray(t)||(t=this.toPath(t)),t.reduce(((e,s,o)=>o===t.length-1?(delete e[s],!0):Object(e)[s]),e)}toPath(e){return e.replace(/\[(\d+)\]/g,".$1").split(".").filter(Boolean)}escape(e){const t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"};return e.replace(/[&<>"']/g,(e=>t[e]))}unescape(e){const t={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"};return e.replace(/&amp;|&lt;|&gt;|&quot;|&#39;/g,(e=>t[e]))}}var s={Switch:!0},o={Settings:s},a={Switch:!0,Title:"â˜ ð™’ð˜¼ð™ð™‹ ð™„ð™£ð™›ð™¤",Icon:"lock.icloud.fill",IconColor:"#f48220",BackgroundColor:"#f6821f",Language:"auto"},r={Request:{url:"https://api.cloudflareclient.com",headers:{authorization:null,"content-Type":"application/json","user-agent":"1.1.1.1/6.22","cf-client-version":"i-6.22-2308151957.1"}},i18n:{"zh-Hans":{IPv4:"IPv4",IPv6:"IPv6",COLO:"æ‰˜ç®¡ä¸­å¿ƒ",WARP_Level:"éšç§ä¿æŠ¤",Account_Type:"è´¦æˆ·ç±»åž‹",Data_Info:"æµé‡ä¿¡æ¯",Unknown:"æœªçŸ¥",Fail:"èŽ·å–å¤±è´¥",WARP_Level_Off:"å…³é—­",WARP_Level_On:"å¼€å¯",WARP_Level_Plus:"å¢žå¼º",Account_Type_unlimited:"æ— é™ç‰ˆ",Account_Type_limited:"æœ‰é™ç‰ˆ",Account_Type_team:"å›¢é˜Ÿç‰ˆ",Account_Type_plus:"WARP+",Account_Type_free:"å…è´¹ç‰ˆ",Data_Info_Used:"å·²ç”¨",Data_Info_Residual:"å‰©ä½™",Data_Info_Total:"æ€»è®¡",Data_Info_Unlimited:"æ— é™"},"zh-Hant":{IPv4:"IPv4",IPv6:"IPv6",COLO:"è¨—ç®¡ä¸­å¿ƒ",WARP_Level:"éš±ç§ä¿è­·",Account_Type:"è³¬æˆ¶é¡žåž‹",Data_Info:"æµé‡ä¿¡æ¯",Unknown:"æœªçŸ¥",Fail:"ç²å–å¤±æ•—",WARP_Level_Off:"é—œé–‰",WARP_Level_On:"é–‹å•Ÿ",WARP_Level_Plus:"å¢žå¼·",Account_Type_unlimited:"ç„¡é™ç‰ˆ",Account_Type_limited:"æœ‰é™ç‰ˆ",Account_Type_team:"åœ˜éšŠç‰ˆ",Account_Type_plus:"WARP+",Account_Type_free:"å…è²»ç‰ˆ",Data_Info_Used:"å·²ç”¨",Data_Info_Residual:"å‰©é¤˜",Data_Info_Total:"ç¸½è¨ˆ",Data_Info_Unlimited:"ç„¡é™"},en:{IPv4:"IPv4",IPv6:"IPv6",COLO:"Colo Center",WARP_Level:"WARP Level",Account_Type:"Account Type",Data_Info:"Data Info.",Unknown:"Unknown",Fail:"Fail to Get",WARP_Level_Off:"OFF",WARP_Level_On:"ON",WARP_Level_Plus:"PLUS",Account_Type_unlimited:"Unlimited",Account_Type_limited:"Limited",Account_Type_team:"Team",Account_Type_plus:"WARP+",Account_Type_free:"Free",Data_Info_Used:"Used",Data_Info_Residual:"Remaining",Data_Info_Total:"Earned",Data_Info_Unlimited:"Unlimited"}}},n={Settings:a,Configs:r},i={Switch:!0,setupMode:"ChangeKeypair",Verify:{RegistrationId:null,Mode:"Token",Content:null}},c={Settings:i},l={Switch:!0,IPServer:"ipw.cn",Verify:{Mode:"Token",Content:""},zone:{id:"",name:"",dns_records:[{id:"",type:"A",name:"",content:"",ttl:1,proxied:!1}]}},d={Request:{url:"https://api.cloudflare.com/client/v4",headers:{"content-type":"application/json"}}},h={Settings:l,Configs:d},u={Switch:!0,setupMode:null,deviceType:"iOS",Verify:{License:null,Mode:"Token",Content:null,RegistrationId:null}},p={Request:{url:"https://api.cloudflareclient.com",headers:{authorization:null,"content-Type":"application/json","user-agent":"1.1.1.1/6.22","cf-client-version":"i-6.22-2308151957.1"}},Environment:{iOS:{Type:"i",Version:"v0i2308151957",headers:{"user-agent":"1.1.1.1/6.22","cf-client-version":"i-6.22-2308151957.1"}},macOS:{Type:"m",Version:"v0i2109031904",headers:{"user-agent":"1.1.1.1/2109031904.1 CFNetwork/1327.0.4 Darwin/21.2.0","cf-client-version":"m-2021.12.1.0-0"}},Android:{Type:"a",Version:"v0a1922",headers:{"user-agent":"okhttp/3.12.1","cf-client-version":"a-6.3-1922"}},Windows:{Type:"w",Version:"",headers:{"user-agent":"","cf-client-version":""}},Linux:{Type:"l",Version:"",headers:{"user-agent":"","cf-client-version":""}}}},g={Settings:u,Configs:p},f={Switch:!0,PrivateKey:"",PublicKey:""},y={interface:{addresses:{v4:"",v6:""}},peers:[{public_key:"",endpoint:{host:"",v4:"",v6:""}}]},m={Settings:f,Configs:y},S=Database={Default:Object.freeze({__proto__:null,Settings:s,default:o}),Panel:Object.freeze({__proto__:null,Configs:r,Settings:a,default:n}),"1dot1dot1dot1":Object.freeze({__proto__:null,Settings:i,default:c}),DNS:Object.freeze({__proto__:null,Configs:d,Settings:l,default:h}),WARP:Object.freeze({__proto__:null,Configs:p,Settings:u,default:g}),VPN:Object.freeze({__proto__:null,Configs:y,Settings:f,default:m})};const $=new class{constructor(e,s){this.name=e,this.version="1.5.10",this.data=null,this.dataFile="box.dat",this.logs=[],this.isMute=!1,this.logSeparator="\n",this.encoding="utf-8",this.startTime=(new Date).getTime(),Object.assign(this,s),this.log("","ðŸš© å¼€å§‹!",`ENV v${this.version}`,""),this.lodash=new t(this.name),this.log("",this.name,"")}platform(){return"undefined"!=typeof $environment&&$environment["surge-version"]?"Surge":"undefined"!=typeof $environment&&$environment["stash-version"]?"Stash":"undefined"!=typeof module&&module.exports?"Node.js":"undefined"!=typeof $task?"Quantumult X":"undefined"!=typeof $loon?"Loon":"undefined"!=typeof $rocket?"Shadowrocket":"undefined"!=typeof Egern?"Egern":void 0}isNode(){return"Node.js"===this.platform()}isQuanX(){return"Quantumult X"===this.platform()}isSurge(){return"Surge"===this.platform()}isLoon(){return"Loon"===this.platform()}isShadowrocket(){return"Shadowrocket"===this.platform()}isStash(){return"Stash"===this.platform()}isEgern(){return"Egern"===this.platform()}toObj(e,t=null){try{return JSON.parse(e)}catch{return t}}toStr(e,t=null){try{return JSON.stringify(e)}catch{return t}}getjson(e,t){let s=t;if(this.getdata(e))try{s=JSON.parse(this.getdata(e))}catch{}return s}setjson(e,t){try{return this.setdata(JSON.stringify(e),t)}catch{return!1}}getScript(e){return new Promise((t=>{this.get({url:e},((e,s,o)=>t(o)))}))}runScript(e,t){return new Promise((s=>{let o=this.getdata("@chavy_boxjs_userCfgs.httpapi");o=o?o.replace(/\n/g,"").trim():o;let a=this.getdata("@chavy_boxjs_userCfgs.httpapi_timeout");a=a?1*a:20,a=t&&t.timeout?t.timeout:a;const[r,n]=o.split("@"),i={url:`http://${n}/v1/scripting/evaluate`,body:{script_text:e,mock_type:"cron",timeout:a},headers:{"X-Key":r,Accept:"*/*"},timeout:a};this.post(i,((e,t,o)=>s(o)))})).catch((e=>this.logErr(e)))}loaddata(){if(!this.isNode())return{};{this.fs=this.fs?this.fs:require("fs"),this.path=this.path?this.path:require("path");const e=this.path.resolve(this.dataFile),t=this.path.resolve(process.cwd(),this.dataFile),s=this.fs.existsSync(e),o=!s&&this.fs.existsSync(t);if(!s&&!o)return{};{const o=s?e:t;try{return JSON.parse(this.fs.readFileSync(o))}catch(e){return{}}}}}writedata(){if(this.isNode()){this.fs=this.fs?this.fs:require("fs"),this.path=this.path?this.path:require("path");const e=this.path.resolve(this.dataFile),t=this.path.resolve(process.cwd(),this.dataFile),s=this.fs.existsSync(e),o=!s&&this.fs.existsSync(t),a=JSON.stringify(this.data);s?this.fs.writeFileSync(e,a):o?this.fs.writeFileSync(t,a):this.fs.writeFileSync(e,a)}}getdata(e){let t=this.getval(e);if(/^@/.test(e)){const[,s,o]=/^@(.*?)\.(.*?)$/.exec(e),a=s?this.getval(s):"";if(a)try{const e=JSON.parse(a);t=e?this.lodash.get(e,o,""):t}catch(e){t=""}}return t}setdata(e,t){let s=!1;if(/^@/.test(t)){const[,o,a]=/^@(.*?)\.(.*?)$/.exec(t),r=this.getval(o),n=o?"null"===r?null:r||"{}":"{}";try{const t=JSON.parse(n);this.lodash.set(t,a,e),s=this.setval(JSON.stringify(t),o)}catch(t){const r={};this.lodash.set(r,a,e),s=this.setval(JSON.stringify(r),o)}}else s=this.setval(e,t);return s}getval(e){switch(this.platform()){case"Surge":case"Loon":case"Stash":case"Egern":case"Shadowrocket":return $persistentStore.read(e);case"Quantumult X":return $prefs.valueForKey(e);case"Node.js":return this.data=this.loaddata(),this.data[e];default:return this.data&&this.data[e]||null}}setval(e,t){switch(this.platform()){case"Surge":case"Loon":case"Stash":case"Egern":case"Shadowrocket":return $persistentStore.write(e,t);case"Quantumult X":return $prefs.setValueForKey(e,t);case"Node.js":return this.data=this.loaddata(),this.data[t]=e,this.writedata(),!0;default:return this.data&&this.data[t]||null}}initGotEnv(e){this.got=this.got?this.got:require("got"),this.cktough=this.cktough?this.cktough:require("tough-cookie"),this.ckjar=this.ckjar?this.ckjar:new this.cktough.CookieJar,e&&(e.headers=e.headers?e.headers:{},void 0===e.headers.Cookie&&void 0===e.cookieJar&&(e.cookieJar=this.ckjar))}async fetch(e={}||"",t={}){switch(e.constructor){case Object:e={...e,...t};break;case String:e={url:e,...t}}e.method||(e.method="GET",(e.body??e.bodyBytes)&&(e.method="POST")),delete e.headers?.["Content-Length"],delete e.headers?.["content-length"];const s=e.method.toLocaleLowerCase();switch(this.platform()){case"Loon":case"Surge":case"Stash":case"Egern":case"Shadowrocket":default:return delete e.id,e.policy&&(this.isLoon()&&(e.node=e.policy),this.isStash()&&this.lodash.set(e,"headers.X-Stash-Selected-Proxy",encodeURI(e.policy))),ArrayBuffer.isView(e.body)&&(e["binary-mode"]=!0),await new Promise(((t,o)=>{$httpClient[s](e,((s,a,r)=>{s?o(s):(a.ok=/^2\d\d$/.test(a.status),a.statusCode=a.status,r&&(a.body=r,1==e["binary-mode"]&&(a.bodyBytes=r)),t(a))}))}));case"Quantumult X":switch(delete e.charset,delete e.path,delete e.scheme,delete e.sessionIndex,delete e.statusCode,e.policy&&this.lodash.set(e,"opts.policy",e.policy),(e?.headers?.["Content-Type"]??e?.headers?.["content-type"])?.split(";")?.[0]){default:delete e.bodyBytes;break;case"application/protobuf":case"application/x-protobuf":case"application/vnd.google.protobuf":case"application/grpc":case"application/grpc+proto":case"application/octet-stream":delete e.body,ArrayBuffer.isView(e.bodyBytes)&&(e.bodyBytes=e.bodyBytes.buffer.slice(e.bodyBytes.byteOffset,e.bodyBytes.byteLength+e.bodyBytes.byteOffset));case void 0:}return await $task.fetch(e).then((e=>(e.ok=/^2\d\d$/.test(e.statusCode),e.status=e.statusCode,e)),(e=>Promise.reject(e.error)));case"Node.js":let t=require("iconv-lite");this.initGotEnv(e);const{url:o,...a}=e;return await this.got[s](o,a).on("redirect",((e,t)=>{try{if(e.headers["set-cookie"]){const s=e.headers["set-cookie"].map(this.cktough.Cookie.parse).toString();s&&this.ckjar.setCookieSync(s,null),t.cookieJar=this.ckjar}}catch(e){this.logErr(e)}})).then((e=>(e.statusCode=e.status,e.body=t.decode(e.rawBody,this.encoding),e.bodyBytes=e.rawBody,e)),(e=>Promise.reject(e.message)))}}time(e,t=null){const s=t?new Date(t):new Date;let o={"M+":s.getMonth()+1,"d+":s.getDate(),"H+":s.getHours(),"m+":s.getMinutes(),"s+":s.getSeconds(),"q+":Math.floor((s.getMonth()+3)/3),S:s.getMilliseconds()};/(y+)/.test(e)&&(e=e.replace(RegExp.$1,(s.getFullYear()+"").substr(4-RegExp.$1.length)));for(let t in o)new RegExp("("+t+")").test(e)&&(e=e.replace(RegExp.$1,1==RegExp.$1.length?o[t]:("00"+o[t]).substr((""+o[t]).length)));return e}msg(e=name,t="",s="",o){const a=e=>{switch(typeof e){case void 0:return e;case"string":switch(this.platform()){case"Surge":case"Stash":case"Egern":default:return{url:e};case"Loon":case"Shadowrocket":return e;case"Quantumult X":return{"open-url":e};case"Node.js":return}case"object":switch(this.platform()){case"Surge":case"Stash":case"Egern":case"Shadowrocket":default:return{url:e.url||e.openUrl||e["open-url"]};case"Loon":return{openUrl:e.openUrl||e.url||e["open-url"],mediaUrl:e.mediaUrl||e["media-url"]};case"Quantumult X":return{"open-url":e["open-url"]||e.url||e.openUrl,"media-url":e["media-url"]||e.mediaUrl,"update-pasteboard":e["update-pasteboard"]||e.updatePasteboard};case"Node.js":return}default:return}};if(!this.isMute)switch(this.platform()){case"Surge":case"Loon":case"Stash":case"Egern":case"Shadowrocket":default:$notification.post(e,t,s,a(o));break;case"Quantumult X":$notify(e,t,s,a(o));case"Node.js":}if(!this.isMuteLog){let o=["","==============ðŸ“£ç³»ç»Ÿé€šçŸ¥ðŸ“£=============="];o.push(e),t&&o.push(t),s&&o.push(s),console.log(o.join("\n")),this.logs=this.logs.concat(o)}}log(...e){e.length>0&&(this.logs=[...this.logs,...e]),console.log(e.join(this.logSeparator))}logErr(e){switch(this.platform()){case"Surge":case"Loon":case"Stash":case"Egern":case"Shadowrocket":case"Quantumult X":default:this.log("",`â—ï¸ ${this.name}, é”™è¯¯!`,e);break;case"Node.js":this.log("",`â—ï¸${this.name}, é”™è¯¯!`,e.stack)}}wait(e){return new Promise((t=>setTimeout(t,e)))}done(e={}){const t=((new Date).getTime()-this.startTime)/1e3;switch(this.log("",`ðŸš© ${this.name}, ç»“æŸ! ðŸ•› ${t} ç§’`,""),e.headers?.["Content-Encoding"]&&(e.headers["Content-Encoding"]="identity"),e.headers?.["content-encoding"]&&(e.headers["content-encoding"]="identity"),this.platform()){case"Surge":case"Loon":case"Stash":case"Egern":case"Shadowrocket":default:$done(e);break;case"Quantumult X":delete e.charset,delete e.host,delete e.method,delete e.path,delete e.scheme,delete e.sessionIndex,delete e.statusCode,e.body instanceof ArrayBuffer?(e.bodyBytes=e.body,delete e.body):ArrayBuffer.isView(e.body)?(e.bodyBytes=e.body.buffer.slice(e.body.byteOffset,e.body.byteLength+e.body.byteOffset),delete e.body):e.body&&delete e.bodyBytes,$done(e);break;case"Node.js":process.exit(1)}}getENV(e,t,s){let o=this.getjson(e,s),a={};if("undefined"!=typeof $argument&&Boolean($argument)){let e=Object.fromEntries($argument.split("&").map((e=>e.split("=").map((e=>e.replace(/\"/g,""))))));for(let t in e)this.lodash.set(a,t,e[t])}const r={Settings:s?.Default?.Settings||{},Configs:s?.Default?.Configs||{},Caches:{}};Array.isArray(t)||(t=[t]);for(let e of t)r.Settings={...r.Settings,...s?.[e]?.Settings,...a,...o?.[e]?.Settings},r.Configs={...r.Configs,...s?.[e]?.Configs},o?.[e]?.Caches&&"string"==typeof o?.[e]?.Caches&&(o[e].Caches=JSON.parse(o?.[e]?.Caches)),r.Caches={...r.Caches,...o?.[e]?.Caches};return this.traverseObject(r.Settings,((e,t)=>("true"===t||"false"===t?t=JSON.parse(t):"string"==typeof t&&(t=t.includes(",")?t.split(",").map((e=>this.string2number(e))):this.string2number(t)),t))),r}traverseObject(e,t){for(var s in e){var o=e[s];e[s]="object"==typeof o&&null!==o?this.traverseObject(o,t):t(s,o)}return e}string2number(e){return e&&!isNaN(e)&&(e=parseInt(e,10)),e}}("â˜ Cloudflare: ðŸ‡© DNS v2.5.0(1)"),_=new class{constructor(e,t){this.name="Cloudflare API v4",this.version="1.1.0",this.option=t,this.baseURL="https://api.cloudflare.com/client/v4",this.$=e,console.log(`\n${this.name} v${this.version}\n`)}async trace(e){return this.$.log("âš ï¸ trace: è¿½è¸ªè·¯ç”±"),e.url="https://cloudflare.com/cdn-cgi/trace",delete e.headers,await this.$.fetch(e,this.option).then((e=>Object.fromEntries(e.body.trim().split("\n").map((e=>e.split("="))))))}async trace4(e){return this.$.log("âš ï¸ trace4: è¿½è¸ªIPv4è·¯ç”±"),e.url="https://162.159.36.1/cdn-cgi/trace",delete e.headers,await this.$.fetch(e,this.option).then((e=>Object.fromEntries(e.body.trim().split("\n").map((e=>e.split("="))))))}async trace6(e){return this.$.log("âš ï¸ trace6: è¿½è¸ªIPv6è·¯ç”±"),e.url="https://[2606:4700:4700::1111]/cdn-cgi/trace",delete e.headers,await this.$.fetch(e,this.option).then((e=>Object.fromEntries(e.body.trim().split("\n").map((e=>e.split("="))))))}async verifyToken(e){return this.$.log("âš ï¸ verifyToken: éªŒè¯ä»¤ç‰Œ"),e.url=this.baseURL+"/user/tokens/verify",await this.fetch(e,this.option)}async getUser(e){return this.$.log("âš ï¸ getUser: èŽ·å–ç”¨æˆ·ä¿¡æ¯"),e.url=this.baseURL+"/user",await this.fetch(e,this.option)}async getZone(e,t){return this.$.log("âš ï¸ getZone: èŽ·å–åŒºåŸŸè¯¦æƒ…"),e.url=this.baseURL+`/zones/${t.id}`,await this.fetch(e,this.option)}async listZones(e,t){return this.$.log("âš ï¸ listZones: åˆ—å‡ºåŒºåŸŸ"),e.url=this.baseURL+`/zones?name=${t.name}`,await this.fetch(e,this.option)}async createDNSRecord(e,t,s){return this.$.log("âš ï¸ createDNSRecord: åˆ›å»ºæ–°DNSè®°å½•"),e.url=this.baseURL+`/zones/${t.id}/dns_records`,e.body=s,await this.fetch(e,this.option)}async getDNSRecord(e,t,s){return this.$.log("âš ï¸ getDNSRecord: èŽ·å–DNSè®°å½•è¯¦æƒ…"),e.url=this.baseURL+`/zones/${t.id}/dns_records/${s.id}`,await this.fetch(e,this.option)}async listDNSRecords(e,t,s){return this.$.log("âš ï¸ listDNSRecords: åˆ—å‡ºDNSè®°å½•"),e.url=this.baseURL+`/zones/${t.id}/dns_records?type=${s.type}&name=${s.name}.${t.name}&order=type`,await this.fetch(e,this.option)}async updateDNSRecord(e,t,s){return this.$.log("âš ï¸ updateDNSRecord: æ›´æ–°DNSè®°å½•"),e.method="PUT",e.url=this.baseURL+`/zones/${t.id}/dns_records/${s.id}`,e.body=s,await this.fetch(e,this.option)}async fetch(t,s){return await this.$.fetch(t,s).then((e=>{const t=JSON.parse(e.body);switch(Array.isArray(t.messages)&&t.messages.forEach((e=>{1e4!==e.code&&this.$.msg(this.$.name,`code: ${e.code}`,`message: ${e.message}`)})),t.success){case!0:return t?.result?.[0]??t?.result;case!1:Array.isArray(t.errors)&&t.errors.forEach((e=>this$.msg(this.$.name,`code: ${e.code}`,`message: ${e.message}`)));break;case void 0:return e}}),(t=>this.$.logErr("â—ï¸ Cloudflare æ‰§è¡Œå¤±è´¥",` error = ${t||e}`,"")))}}($);async function v(t,s){$.log(`â˜‘ï¸ get External IP, type: ${t}, server: ${s}`);const o={};switch(s){case"ipw.cn":o.url=`https://${t}.ipw.cn/api/ip/myip?json`;break;case"my-ip.io":o.url=`https://api${t}.my-ip.io/ip.json`}return $.log("ðŸš§ get External IP",`request: ${JSON.stringify(o)}`),await $.fetch(o).then((e=>{let t=JSON.parse(e.body);switch($.log("ðŸš§ get External IP",`body: ${JSON.stringify(t)}`),t?.success??t?.result){case!0:return t.IP??t.ip;case!1:Array.isArray(t.errors)&&t.errors.forEach((e=>{$.msg($.name,`code: ${e.code}`,`message: ${e.message}`)})),Array.isArray(t.messages)&&$.msg($.name,`code: ${t.code}`,`message: ${t.message}`);break;default:return t?.result?.[0]??t?.result}}),(t=>$.logErr("â—ï¸ get External IP",` error = ${t||e}`,"")))}(async()=>{const{Settings:e,Caches:t,Configs:s}=function(e,t,s,o){e.log("â˜‘ï¸ Set Environment Variables","");let{Settings:a,Caches:r,Configs:n}=e.getENV(t,s,o);switch(a.Verify?.Mode){case"Token":n.Request.headers.authorization=`Bearer ${a.Verify?.Content}`;break;case"ServiceKey":n.Request.headers["x-auth-user-service-key"]=a.Verify?.Content;break;case"Key":a.Verify.Content=Array.from(a.Verify?.Content.split("\n")),n.Request.headers["x-auth-key"]=a.Verify?.Content[0],n.Request.headers["x-auth-email"]=a.Verify?.Content[1];break;default:e.log("æ— å¯ç”¨æŽˆæƒæ–¹å¼",`Mode=${a.Verify?.Mode}`,`Content=${a.Verify?.Content}`);case void 0:}return a.zone?.dns_records&&(a.zone.dns_records=Array.from(a.zone.dns_records.split("\n")),a.zone.dns_records.forEach(((e,t)=>{a.zone.dns_records[t]=Object.fromEntries(e.split("&").map((e=>e.split("=")))),a.zone.dns_records[t].proxied=JSON.parse(a.zone.dns_records[t].proxied)}))),e.log("âœ… Set Environment Variables","Settings: "+typeof a,`Settingså†…å®¹: ${JSON.stringify(a)}`,""),{Settings:a,Caches:r,Configs:n}}($,"Cloudflare","DNS",S);let o=await async function(e,t){$.log("éªŒè¯æŽˆæƒ");let s={};switch(t.Mode){case"Token":s=await _.verifyToken(e);break;case"ServiceKey":case"Key":s=await _.getUser(e);break;default:$.log("æ— å¯ç”¨æŽˆæƒæ–¹å¼",`Mode=${t.Mode}`,`Content=${t.Content}`,"")}return"active"===s?.status||!1===s?.suspended}(s.Request,e.Verify);if(!0!==o)throw new Error("éªŒè¯å¤±è´¥");$.log("éªŒè¯æˆåŠŸ"),e.zone=await async function(e,t){$.log("æŸ¥è¯¢åŒºåŸŸä¿¡æ¯");let s={};t?.id&&t?.name?($.log(`æœ‰åŒºåŸŸID${t.id}å’ŒåŒºåŸŸåç§°${t.name}, ç»§ç»­`),s=t):t?.id?($.log(`æœ‰åŒºåŸŸID${t.id}, ç»§ç»­`),s=await _.getZone(e,t)):t?.name?($.log(`æœ‰åŒºåŸŸåç§°${t.name}, ç»§ç»­`),s=await _.listZones(e,t)):($.logErr("æœªæä¾›è®°å½•IDå’Œåç§°, ç»ˆæ­¢"),$.done());$.log("åŒºåŸŸæŸ¥è¯¢ç»“æžœ:",`ID:${s.id}`,`åç§°:${s.name}`,`çŠ¶æ€:${s.status}`,`ä»…DNSæœåŠ¡:${s.paused}`,`ç±»åž‹:${s.type}`,`å¼€å‘è€…æ¨¡å¼:${s.development_mode}`,`åç§°æœåŠ¡å™¨:${s.name_servers}`,`åŽŸå§‹åç§°æœåŠ¡å™¨:${s.original_name_servers}`,"");return{...t,...s}}(s.Request,e.zone),await Promise.allSettled(e.zone.dns_records.map((async t=>{$.log(`å¼€å§‹æ›´æ–°${t.type}ç±»åž‹è®°å½•`);let o=await async function(e,t,s){$.log("æŸ¥è¯¢è®°å½•ä¿¡æ¯");let o={};s.id?($.log(`æœ‰è®°å½•ID${s.id}, ç»§ç»­`),o=await _.getDNSRecord(e,t,s)):s.name?($.log(`æœ‰è®°å½•åç§°${s.name}, ç»§ç»­`),o=await _.listDNSRecords(e,t,s)):($.log("æœªæä¾›è®°å½•IDå’Œåç§°, ç»ˆæ­¢"),$.done());return $.log("è®°å½•æŸ¥è¯¢ç»“æžœ:",`ID:${o.id}`,`åç§°:${o.name}`,`ç±»åž‹:${o.type}`,`å†…å®¹:${o.content}`,`ä»£ç†çŠ¶æ€:${o.proxied}`,`TTL:${o.ttl}`,""),o}(s.Request,e.zone,t),a=await async function(e,t){if(e.type)if($.log(`æœ‰ç±»åž‹${e.type}, ç»§ç»­`),e.content)$.log(`æœ‰å†…å®¹${e.content}, è·³è¿‡`);else switch($.log("æ— å†…å®¹, ç»§ç»­"),e.type){case"A":e.content=await v(4,t);break;case"AAAA":e.content=await v(6,t);break;case void 0:$.log("æ— ç±»åž‹, è·³è¿‡");break;default:$.log(`ç±»åž‹${e.type}, è·³è¿‡`)}else $.log(`æ— ç±»åž‹${e.type}, è·³è¿‡`);return $.log(`${e.type}ç±»åž‹å†…å®¹: ${e.content}`,""),e}(t,e.IPServer),r=await async function(e,t,s,o){$.log("å¼€å§‹æ›´æ–°å†…å®¹");let a={};s.content?s.content!==o.content?($.log("æœ‰è®°å½•ä¸”IPåœ°å€ä¸åŒ"),a=await _.updateDNSRecord(e,t,{...s,...o})):s.content===o.content&&($.log("æœ‰è®°å½•ä¸”IPåœ°å€ç›¸åŒ"),a=s):($.log("æ— è®°å½•"),a=await _.createDNSRecord(e,t,o));return $.log("è®°å½•æ›´æ–°ç»“æžœ:",`ID:${a.id}`,`åç§°:${a.name}`,`ç±»åž‹:${a.type}`,`å†…å®¹:${a.content}`,`å¯ä»£ç†:${a.proxiable}`,`ä»£ç†çŠ¶æ€:${a.proxied}`,`TTL:${a.ttl}`,`å·²é”å®š:${a.locked}`,""),a}(s.Request,e.zone,o,a);$.log(`${r.name}ä¸Šçš„${r.type}è®°å½•${r.content}æ›´æ–°å®Œæˆ`,"")})))})().catch((e=>$.logErr(e))).finally((()=>$.done()));
